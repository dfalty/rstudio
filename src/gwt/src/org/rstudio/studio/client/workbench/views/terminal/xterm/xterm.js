(function(t){"object"===typeof exports&&"undefined"!==typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).Terminal=t()})(function(){return function l(n,e,b){function m(i,p){if(!e[i]){if(!n[i]){var j="function"==typeof require&&require;if(!p&&j)return j(i,!0);if(f)return f(i,!0);j=Error("Cannot find module '"+i+"'");throw j.code="MODULE_NOT_FOUND",j;}j=e[i]={exports:{}};
n[i][0].call(j.exports,function(b){var f=n[i][1][b];return m(f?f:b)},j,j.exports,l,n,e,b)}return e[i].exports}for(var f="function"==typeof require&&require,i=0;i<b.length;i++)m(b[i]);return m}({1:[function(l,n,e){function b(b,f,i){this.textarea=b;this.compositionView=f;this.terminal=i;this.isComposing=!1;this.compositionText=null;this.compositionPosition={start:null,end:null};this.isSendingComposition=!1}Object.defineProperty(e,"__esModule",{value:!0});b.prototype.compositionstart=function(){this.isComposing=
!0;this.compositionPosition.start=this.textarea.value.length;this.compositionView.textContent="";this.compositionView.classList.add("active")};b.prototype.compositionupdate=function(b){this.compositionView.textContent=b.data;this.updateCompositionElements();var f=this;setTimeout(function(){f.compositionPosition.end=f.textarea.value.length},0)};b.prototype.compositionend=function(){this.finalizeComposition(!0)};b.prototype.keydown=function(b){if(this.isComposing||this.isSendingComposition){if(229===
b.keyCode||16===b.keyCode||17===b.keyCode||18===b.keyCode)return!1;this.finalizeComposition(!1)}return 229===b.keyCode?(this.handleAnyTextareaChanges(),!1):!0};b.prototype.finalizeComposition=function(b){this.compositionView.classList.remove("active");this.isComposing=!1;this.clearTextareaPosition();if(b){var f=this.compositionPosition.start,i=this.compositionPosition.end,e=this;this.isSendingComposition=!0;setTimeout(function(){if(e.isSendingComposition){e.isSendingComposition=!1;var b;b=e.isComposing?
e.textarea.value.substring(f,i):e.textarea.value.substring(f);e.terminal.handler(b)}},0)}else this.isSendingComposition=!1,this.terminal.handler(this.textarea.value.substring(this.compositionPosition.start,this.compositionPosition.end))};b.prototype.handleAnyTextareaChanges=function(){var b=this.textarea.value,f=this;setTimeout(function(){if(!f.isComposing){var i=f.textarea.value.replace(b,"");0<i.length&&f.terminal.handler(i)}},0)};b.prototype.updateCompositionElements=function(b){if(this.isComposing){var f=
this.terminal.element.querySelector(".terminal-cursor");if(f){var i=this.terminal.element.querySelector(".xterm-rows").offsetTop+f.offsetTop;this.compositionView.style.left=f.offsetLeft+"px";this.compositionView.style.top=i+"px";this.compositionView.style.height=f.offsetHeight+"px";this.compositionView.style.lineHeight=f.offsetHeight+"px";var e=this.compositionView.getBoundingClientRect();this.textarea.style.left=f.offsetLeft+"px";this.textarea.style.top=i+"px";this.textarea.style.width=e.width+"px";
this.textarea.style.height=e.height+"px";this.textarea.style.lineHeight=e.height+"px"}b||setTimeout(this.updateCompositionElements.bind(this,!0),0)}};b.prototype.clearTextareaPosition=function(){this.textarea.style.left="";this.textarea.style.top=""};e.CompositionHelper=b},{}],2:[function(l,n,e){function b(){this._events=this._events||{}}Object.defineProperty(e,"__esModule",{value:!0});b.prototype.addListener=function(b,f){this._events[b]=this._events[b]||[];this._events[b].push(f)};b.prototype.on=
b.prototype.addListener;b.prototype.removeListener=function(b,f){if(this._events[b])for(var i=this._events[b],e=i.length;e--;)if(i[e]===f||i[e].listener===f){i.splice(e,1);break}};b.prototype.off=b.prototype.removeListener;b.prototype.removeAllListeners=function(b){this._events[b]&&delete this._events[b]};b.prototype.once=function(b,f){function i(){var e=Array.prototype.slice.call(arguments);this.removeListener(b,i);return f.apply(this,e)}i.listener=f;return this.on(b,i)};b.prototype.emit=function(b){if(this._events[b])for(var f=
Array.prototype.slice.call(arguments,1),i=this._events[b],e=i.length,p=0;p<e;p++)i[p].apply(this,f)};b.prototype.listeners=function(b){return this._events[b]=this._events[b]||[]};e.EventEmitter=b},{}],3:[function(l,n,e){function b(b,f,e,l){this.terminal=b;this.viewportElement=f;this.scrollArea=e;this.charMeasureElement=l;this.lastRecordedViewportHeight=this.lastRecordedBufferLength=this.currentRowHeight=0;this.terminal.on("scroll",this.syncScrollArea.bind(this));this.terminal.on("resize",this.syncScrollArea.bind(this));
this.viewportElement.addEventListener("scroll",this.onScroll.bind(this));this.syncScrollArea()}Object.defineProperty(e,"__esModule",{value:!0});b.prototype.refresh=function(b){b=b||this.charMeasureElement.getBoundingClientRect();if(0<b.height){var f=b.height!==this.currentRowHeight;f&&(this.currentRowHeight=b.height,this.viewportElement.style.lineHeight=b.height+"px",this.terminal.rowContainer.style.lineHeight=b.height+"px");var e=this.lastRecordedViewportHeight!==this.terminal.rows;if(f||e)this.lastRecordedViewportHeight=
this.terminal.rows,this.viewportElement.style.height=b.height*this.terminal.rows+"px";this.scrollArea.style.height=b.height*this.lastRecordedBufferLength+"px"}};b.prototype.syncScrollArea=function(){if(this.lastRecordedBufferLength!==this.terminal.lines.length)this.lastRecordedBufferLength=this.terminal.lines.length,this.refresh();else if(this.lastRecordedViewportHeight!==this.terminal.rows)this.refresh();else{var b=this.charMeasureElement.getBoundingClientRect();b.height!==this.currentRowHeight&&
this.refresh(b)}b=this.terminal.ydisp*this.currentRowHeight;this.viewportElement.scrollTop!==b&&(this.viewportElement.scrollTop=b)};b.prototype.onScroll=function(){this.terminal.scrollDisp(Math.round(this.viewportElement.scrollTop/this.currentRowHeight)-this.terminal.ydisp,!0)};b.prototype.onWheel=function(b){if(0!==b.deltaY){var f=1;b.deltaMode===WheelEvent.DOM_DELTA_LINE?f=this.currentRowHeight:b.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(f=this.currentRowHeight*this.terminal.rows);this.viewportElement.scrollTop+=
b.deltaY*f;b.preventDefault()}};e.Viewport=b},{}],4:[function(l,n,e){function b(b){var f=String.fromCharCode(32),e=String.fromCharCode(160),l=RegExp(e,"g");return b.split("\n").map(function(b){return b.replace(/\s+$/g,"").replace(l,f)}).join("\n")}Object.defineProperty(e,"__esModule",{value:!0});e.prepareTextForClipboard=b;e.copyHandler=function(e,f){var i=window.getSelection().toString(),i=b(i);f.browser.isMSIE?window.clipboardData.setData("Text",i):e.clipboardData.setData("text/plain",i);e.preventDefault()};
e.pasteHandler=function(b,f){b.stopPropagation();var e=function(e){f.handler(e);f.textarea.value="";return f.cancel(b)};if(f.browser.isMSIE){if(window.clipboardData){var l=window.clipboardData.getData("Text");e(l)}}else b.clipboardData&&(l=b.clipboardData.getData("text/plain"),e(l))};e.rightClickHandler=function(e,f){var i=document.getSelection(),l=b(i.toString()),n=!1;if(i.rangeCount){var i=i.getRangeAt(0).getClientRects(),j=e.clientX,q=e.clientY,r;for(r=0;r<i.length&&!(n=i[r],n=j>n.left&&j<n.right&&
q>n.top&&q<n.bottom);r++);if(l.match(/^\s$/)||!l.length)n=!1}n||(f.textarea.style.position="fixed",f.textarea.style.width="20px",f.textarea.style.height="20px",f.textarea.style.left=j-10+"px",f.textarea.style.top=q-10+"px",f.textarea.style.zIndex=1E3,f.textarea.focus(),setTimeout(function(){f.textarea.style.position=null;f.textarea.style.width=null;f.textarea.style.height=null;f.textarea.style.left=null;f.textarea.style.top=null;f.textarea.style.zIndex=null},4))}},{}],5:[function(l,n,e){Object.defineProperty(e,
"__esModule",{value:!0});e.isMSWindows=e.isIphone=e.isIpad=e.isMac=e.isMSIE=e.isFirefox=void 0;var l=l("./Generic.js"),b="undefined"==typeof navigator?!0:!1,n=b?"node":navigator.userAgent,b=b?"node":navigator.platform;e.isFirefox=!!~n.indexOf("Firefox");e.isMSIE=!!~n.indexOf("MSIE")||!!~n.indexOf("Trident");e.isMac=(0,l.contains)(["Macintosh","MacIntel","MacPPC","Mac68K"],b);e.isIpad="iPad"===b;e.isIphone="iPhone"===b;e.isMSWindows=(0,l.contains)(["Windows","Win16","Win32","WinCE"],b)},{"./Generic.js":6}],
6:[function(l,n,e){Object.defineProperty(e,"__esModule",{value:!0});e.contains=function(b,e){return 0<=b.indexOf(e)}},{}],7:[function(l,n,e){function b(a,h,c){var d=this;if(!(this instanceof b))return new b(a,h,c);d.browser=A;d.cancel=b.cancel;u.EventEmitter.call(this);"number"===typeof a&&(a={cols:a,rows:h,handler:c});a=a||{};Object.keys(b.defaults).forEach(function(h){null==a[h]&&(a[h]=b.options[h],b[h]!==b.defaults[h]&&(a[h]=b[h]));d[h]=a[h]});8===a.colors.length?a.colors=a.colors.concat(b._colors.slice(8)):
16===a.colors.length?a.colors=a.colors.concat(b._colors.slice(16)):10===a.colors.length?a.colors=a.colors.slice(0,-2).concat(b._colors.slice(8,-2),a.colors.slice(-2)):18===a.colors.length&&(a.colors=a.colors.concat(b._colors.slice(16,-2),a.colors.slice(-2)));this.colors=a.colors;this.options=a;this.parent=a.body||a.parent||(o?o.getElementsByTagName("body")[0]:null);this.cols=a.cols||a.geometry[0];this.rows=a.rows||a.geometry[1];this.geometry=[this.cols,this.rows];if(a.handler)this.on("data",a.handler);
this.y=this.x=this.ydisp=this.ybase=0;this.isRefreshing=!1;this.cursorState=0;this.cursorHidden=!1;this.convertEol;this.state=0;this.queue="";this.scrollTop=0;this.scrollBottom=this.rows-1;this.customKeydownHandler=null;this.insertMode=this.originMode=this.applicationCursor=this.applicationKeypad=!1;this.wraparoundMode=!0;this.gcharset=this.charset=this.normal=null;this.glevel=0;this.charsets=[null];this.decLocator;this.x10Mouse;this.vt200Mouse;this.vt300Mouse;this.normalMouse;this.mouseEvents;this.sendFocus;
this.utfMouse;this.sgrMouse;this.urxvtMouse;this.element;this.children;this.refreshStart;this.refreshEnd;this.savedX;this.savedY;this.savedCols;this.writable=this.readable=!0;this.curAttr=this.defAttr=131840;this.params=[];this.currentParam=0;this.surrogate_high=this.postfix=this.prefix="";this.lines=[];for(h=this.rows;h--;)this.lines.push(this.blankLine());this.tabs;this.setupStops();this.userScrolling=!1}function m(a,b,c,d){Array.isArray(a)||(a=[a]);a.forEach(function(a){a.addEventListener(b,c,
d||!1)})}function f(a,b,c,d){a.removeEventListener(b,c,d||!1)}function i(a,b){function c(){this.constructor=a}c.prototype=b.prototype;a.prototype=new c}function z(a){var b=a.getElementsByTagName("body")[0],a=a.createElement("span");a.innerHTML="hello world";b.appendChild(a);var c=a.scrollWidth;a.style.fontWeight="bold";var d=a.scrollWidth;b.removeChild(a);return c!==d}function p(a,b){var c=a.browser.isMac&&b.altKey&&!b.ctrlKey&&!b.metaKey||a.browser.isMSWindows&&b.altKey&&b.ctrlKey&&!b.metaKey;return"keypress"==
b.type?c:c&&(!b.keyCode||47<b.keyCode)}function j(a,h,c){var d=a<<16|h<<8|c;if(null!=j._cache[d])return j._cache[d];for(var e=Infinity,f=-1,g=0,k,s,x;g<b.vcolors.length;g++){k=b.vcolors[g];s=k[0];x=k[1];k=k[2];s=j.distance(a,h,c,s,x,k);if(0===s){f=g;break}s<e&&(e=s,f=g)}return j._cache[d]=f}var q="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},
r=l("./CompositionHelper.js"),u=l("./EventEmitter.js"),y=l("./Viewport.js"),w=l("./handlers/Clipboard.js"),A=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(l("./utils/Browser")),o="undefined"!=typeof window?window.document:null;i(b,u.EventEmitter);b.prototype.eraseAttr=function(){return this.defAttr&-512|this.curAttr&511};b.tangoColors="#2e3436,#cc0000,#4e9a06,#c4a000,#3465a4,#75507b,#06989a,#d3d7cf,#555753,#ef2929,#8ae234,#fce94f,#729fcf,#ad7fa8,#34e2e2,#eeeeec".split(",");
b.colors=function(){function a(a,b,d){c.push("#"+h(a)+h(b)+h(d))}function h(a){a=a.toString(16);return 2>a.length?"0"+a:a}var c=b.tangoColors.slice(),d=[0,95,135,175,215,255],e;for(e=0;216>e;e++)a(d[e/36%6|0],d[e/6%6|0],d[e%6]);for(e=0;24>e;e++)d=8+10*e,a(d,d,d);return c}();b._colors=b.colors.slice();b.vcolors=function(){for(var a=[],h=b.colors,c=0,d;256>c;c++)d=parseInt(h[c].substring(1),16),a.push([d>>16&255,d>>8&255,d&255]);return a}();b.defaults={colors:b.colors,theme:"default",convertEol:!1,
termName:"xterm",geometry:[80,24],cursorBlink:!1,visualBell:!1,popOnBell:!1,scrollback:1E3,screenKeys:!1,debug:!1,cancelEvents:!1};b.options={};b.focus=null;(function(a,b,c){if(a.forEach)return a.forEach(b,c);for(var d=0;d<a.length;d++)b.call(c,a[d],d,a)})(function(a){if(Object.keys)return Object.keys(a);var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}(b.defaults),function(a){b[a]=b.defaults[a];b.options[a]=b.defaults[a]});b.prototype.focus=function(){return this.textarea.focus()};
b.prototype.getOption=function(a){if(!(a in b.defaults))throw Error('No option with key "'+a+'"');return"undefined"!==typeof this.options[a]?this.options[a]:this[a]};b.prototype.setOption=function(a,h){if(!(a in b.defaults))throw Error('No option with key "'+a+'"');this[a]=h;this.options[a]=h};b.bindFocus=function(a){m(a.textarea,"focus",function(){a.sendFocus&&a.send("\u001b[I");a.element.classList.add("focus");a.showCursor();b.focus=a;a.emit("focus",{terminal:a})})};b.prototype.blur=function(){return this.textarea.blur()};
b.bindBlur=function(a){m(a.textarea,"blur",function(){a.refresh(a.y,a.y);a.sendFocus&&a.send("\u001b[O");a.element.classList.remove("focus");b.focus=null;a.emit("blur",{terminal:a})})};b.prototype.initGlobal=function(){function a(a){w.rightClickHandler.call(this,a,h)}var h=this;b.bindKeys(this);b.bindFocus(this);b.bindBlur(this);m(this.element,"copy",function(a){w.copyHandler.call(this,a,h)});m(this.textarea,"paste",function(a){w.pasteHandler.call(this,a,h)});h.browser.isFirefox?m(this.element,"mousedown",
function(b){2==b.button&&a(b)}):m(this.element,"contextmenu",a)};b.bindKeys=function(a){m(a.element,"keydown",function(b){o.activeElement==this&&a.keyDown(b)},!0);m(a.element,"keypress",function(b){o.activeElement==this&&a.keyPress(b)},!0);m(a.element,"keyup",a.focus.bind(a));m(a.textarea,"keydown",function(b){a.keyDown(b)},!0);m(a.textarea,"keypress",function(b){a.keyPress(b);this.value=""},!0);m(a.textarea,"compositionstart",a.compositionHelper.compositionstart.bind(a.compositionHelper));m(a.textarea,
"compositionupdate",a.compositionHelper.compositionupdate.bind(a.compositionHelper));m(a.textarea,"compositionend",a.compositionHelper.compositionend.bind(a.compositionHelper));a.on("refresh",a.compositionHelper.updateCompositionElements.bind(a.compositionHelper))};b.prototype.insertRow=function(a){if("object"!=("undefined"===typeof a?"undefined":q(a)))a=o.createElement("div");this.rowContainer.appendChild(a);this.children.push(a);return a};b.prototype.open=function(a){var h=this,c=0;this.parent=
a||this.parent;if(!this.parent)throw Error("Terminal requires a parent element.");this.context=this.parent.ownerDocument.defaultView;this.document=this.parent.ownerDocument;this.body=this.document.getElementsByTagName("body")[0];this.element=this.document.createElement("div");this.element.classList.add("terminal");this.element.classList.add("xterm");this.element.classList.add("xterm-theme-"+this.theme);this.element.style.height;this.element.setAttribute("tabindex",0);this.viewportElement=o.createElement("div");
this.viewportElement.classList.add("xterm-viewport");this.element.appendChild(this.viewportElement);this.viewportScrollArea=o.createElement("div");this.viewportScrollArea.classList.add("xterm-scroll-area");this.viewportElement.appendChild(this.viewportScrollArea);this.rowContainer=o.createElement("div");this.rowContainer.classList.add("xterm-rows");this.element.appendChild(this.rowContainer);this.children=[];this.helperContainer=o.createElement("div");this.helperContainer.classList.add("xterm-helpers");
this.element.appendChild(this.helperContainer);this.textarea=o.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea");this.textarea.setAttribute("autocorrect","off");this.textarea.setAttribute("autocapitalize","off");this.textarea.setAttribute("spellcheck","false");this.textarea.tabIndex=0;this.textarea.addEventListener("focus",function(){h.emit("focus",{terminal:h})});this.textarea.addEventListener("blur",function(){h.emit("blur",{terminal:h})});this.helperContainer.appendChild(this.textarea);
this.compositionView=o.createElement("div");this.compositionView.classList.add("composition-view");this.compositionHelper=new r.CompositionHelper(this.textarea,this.compositionView,this);this.helperContainer.appendChild(this.compositionView);this.charMeasureElement=o.createElement("div");this.charMeasureElement.classList.add("xterm-char-measure-element");this.charMeasureElement.innerHTML="W";for(this.helperContainer.appendChild(this.charMeasureElement);c<this.rows;c++)this.insertRow();this.parent.appendChild(this.element);
this.viewport=new y.Viewport(this,this.viewportElement,this.viewportScrollArea,this.charMeasureElement);this.refresh(0,this.rows-1);this.initGlobal();this.focus();m(this.element,"click",function(){var a=o.getSelection(),b=a.isCollapsed;("boolean"==typeof b?!b:"Range"==a.type)||h.focus()});this.bindMouse();null==b.brokenBold&&(b.brokenBold=z(this.document));this.emit("open")};b.loadAddon=function(a){if("object"===("undefined"===typeof e?"undefined":q(e))&&"object"===("undefined"===typeof n?"undefined":
q(n)))return l("../addons/"+a);console.error("Cannot load a module without a CommonJS or RequireJS environment.");return!1};b.prototype.bindMouse=function(){function a(a){var b,c,h,f;switch(a.overrideType||a.type){case "mousedown":b=null!=a.button?+a.button:null!=a.which?a.which-1:null;g.browser.isMSIE&&(b=1===b?0:4===b?1:b);break;case "mouseup":b=3;break;case "DOMMouseScroll":b=0>a.detail?64:65;break;case "wheel":b=0<a.wheelDeltaY?64:65}h=a.shiftKey?4:0;f=a.metaKey?8:0;c=a.ctrlKey?16:0;h=h|f|c;g.vt200Mouse?
h&=c:g.normalMouse||(h=0);b=32+(h<<2)+b;if(c=e(a))switch(d(b,c),a.overrideType||a.type){case "mousedown":k=b;break;case "mouseup":k=32}}function b(a){var c=k;(a=e(a))&&d(c+32,a)}function c(a,b){if(g.utfMouse){if(2047===b)return a.push(0);127>b?a.push(b):(2047<b&&(b=2047),a.push(192|b>>6),a.push(128|b&63))}else{if(255===b)return a.push(0);127<b&&(b=127);a.push(b)}}function d(a,b){if(g.vt300Mouse){a&=3;b.x-=32;b.y-=32;var h="\u001b[24";if(0===a)h+="1";else if(1===a)h+="3";else if(2===a)h+="5";else{if(3===
a)return;h+="0"}h+="~["+b.x+","+b.y+"]\r";g.send(h)}else g.decLocator?(a&=3,b.x-=32,b.y-=32,0===a?a=2:1===a?a=4:2===a?a=6:3===a&&(a=3),g.send("\u001b["+a+";"+(3===a?4:0)+";"+b.y+";"+b.x+";"+(b.page||0)+"&w")):g.urxvtMouse?(b.x-=32,b.y-=32,b.x++,b.y++,g.send("\u001b["+a+";"+b.x+";"+b.y+"M")):g.sgrMouse?(b.x-=32,b.y-=32,g.send("\u001b[<"+(3===(a&3)?a&-4:a)+";"+b.x+";"+b.y+(3===(a&3)?"m":"M"))):(h=[],c(h,a),c(h,b.x),c(h,b.y),g.send("\u001b[M"+String.fromCharCode.apply(String,h)))}function e(a){var b,
h,c;if(null!=a.pageX){b=a.pageX;a=a.pageY;for(h=g.element;h&&h!==g.document.documentElement;)b-=h.offsetLeft,a-=h.offsetTop,h="offsetParent"in h?h.offsetParent:h.parentNode;h=g.element.clientWidth;c=g.element.clientHeight;b=Math.ceil(b/h*g.cols);a=Math.ceil(a/c*g.rows);0>b&&(b=0);b>g.cols&&(b=g.cols);0>a&&(a=0);a>g.rows&&(a=g.rows);return{x:b+32,y:a+32,type:"wheel"}}}var v=this.element,g=this,k=32;m(v,"mousedown",function(c){if(g.mouseEvents){a(c);g.focus();if(g.vt200Mouse)return c.overrideType="mouseup",
a(c),g.cancel(c);g.normalMouse&&m(g.document,"mousemove",b);g.x10Mouse||m(g.document,"mouseup",function B(c){a(c);g.normalMouse&&f(g.document,"mousemove",b);f(g.document,"mouseup",B);return g.cancel(c)});return g.cancel(c)}});m(v,"wheel",function(b){if(g.mouseEvents&&!g.x10Mouse&&!g.vt300Mouse&&!g.decLocator)return a(b),g.cancel(b)});m(v,"wheel",function(a){if(!g.mouseEvents)return g.viewport.onWheel(a),g.cancel(a)})};b.prototype.destroy=function(){this.writable=this.readable=!1;this._events={};this.handler=
function(){};this.write=function(){};this.element.parentNode&&this.element.parentNode.removeChild(this.element)};b.flags={BOLD:1,UNDERLINE:2,BLINK:4,INVERSE:8,INVISIBLE:16};b.prototype.refresh=function(a,h,c){var d=this;if("undefined"==typeof c||c)this._refreshIsQueued?this._fullRefreshNext=!0:(setTimeout(function(){d.refresh(a,h,!1)},34),this._refreshIsQueued=!0);else{this._refreshIsQueued=!1;this._fullRefreshNext&&(a=0,h=this.rows-1,this._fullRefreshNext=!1);var e,f,g,k,i,l,n,m,j,o,q;h-a>=this.rows/
2&&(q=this.element.parentNode)&&this.element.removeChild(this.rowContainer);n=this.cols;c=a;h>=this.rows.length&&(this.log("`end` is too large. Most likely a bad CSR."),h=this.rows.length-1);for(;c<=h;c++){e=c+this.ydisp;g=this.lines[e];k="";e=this.y===c-(this.ybase-this.ydisp)&&this.cursorState&&!this.cursorHidden?this.x:-1;j=this.defAttr;for(f=0;f<n;f++)if(m=g[f][0],i=g[f][1],l=g[f][2]){f===e&&(m=-1);if(m!==j&&(j!==this.defAttr&&(k+="</span>"),m!==this.defAttr))if(-1===m)k+='<span class="reverse-video terminal-cursor',
this.cursorBlink&&(k+=" blinking"),k+='">';else{var p=[];l=m&511;j=m>>9&511;o=m>>18;o&b.flags.BOLD&&(b.brokenBold||p.push("xterm-bold"),8>j&&(j+=8));o&b.flags.UNDERLINE&&p.push("xterm-underline");o&b.flags.BLINK&&p.push("xterm-blink");o&b.flags.INVERSE&&(l=j,o&1&&8>j&&(j+=8));o&b.flags.INVISIBLE&&p.push("xterm-hidden");o&b.flags.INVERSE&&(257==l&&(l=15),256==j&&(j=0));256>l&&p.push("xterm-bg-color-"+l);256>j&&p.push("xterm-color-"+j);k+="<span";p.length&&(k+=' class="'+p.join(" ")+'"');k+=">"}switch(i){case "&":k+=
"&amp;";break;case "<":k+="&lt;";break;case ">":k+="&gt;";break;default:k=" ">=i?k+"&nbsp;":k+i}j=m}j!==this.defAttr&&(k+="</span>");this.children[c].innerHTML=k}q&&this.element.appendChild(this.rowContainer);this.emit("refresh",{element:this.element,start:a,end:h})}};b.prototype.showCursor=function(){this.cursorState||(this.cursorState=1,this.refresh(this.y,this.y))};b.prototype.scroll=function(){var a;++this.ybase===this.scrollback&&(this.ybase=this.ybase/2|0,this.lines=this.lines.slice(-(this.ybase+
this.rows)+1));this.userScrolling||(this.ydisp=this.ybase);a=this.ybase+this.rows-1;a-=this.rows-1-this.scrollBottom;a===this.lines.length?this.lines.push(this.blankLine()):this.lines.splice(a,0,this.blankLine());0!==this.scrollTop&&(0!==this.ybase&&(this.ybase--,this.userScrolling||(this.ydisp=this.ybase)),this.lines.splice(this.ybase+this.scrollTop,1));this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom);this.emit("scroll",this.ydisp)};b.prototype.scrollDisp=function(a,b){0>a?this.userScrolling=
!0:a+this.ydisp>=this.ybase&&(this.userScrolling=!1);this.ydisp+=a;this.ydisp>this.ybase?this.ydisp=this.ybase:0>this.ydisp&&(this.ydisp=0);b||this.emit("scroll",this.ydisp);this.refresh(0,this.rows-1)};b.prototype.scrollPages=function(a){this.scrollDisp(a*(this.rows-1))};b.prototype.scrollToTop=function(){this.scrollDisp(-this.ydisp)};b.prototype.scrollToBottom=function(){this.scrollDisp(this.ybase-this.ydisp)};b.prototype.write=function(a){var h=a.length,c=0,d,e,f;this.refreshEnd=this.refreshStart=
this.y;this.surrogate_high&&(a=this.surrogate_high+a,this.surrogate_high="");for(;c<h;c++){d=a[c];e=a.charCodeAt(c);if(55296<=e&&56319>=e){f=a.charCodeAt(c+1);if(isNaN(f)){this.surrogate_high=d;continue}e=1024*(e-55296)+(f-56320)+65536;d+=a.charAt(c+1)}if(!(56320<=e&&57343>=e))switch(this.state){case 0:switch(d){case "\u0007":this.bell();break;case "\n":case "\x0B":case "\u000c":this.convertEol&&(this.x=0);this.y++;this.y>this.scrollBottom&&(this.y--,this.scroll());break;case "\r":this.x=0;break;
case "\u0008":0<this.x&&this.x--;break;case "\t":this.x=this.nextStop();break;case "\u000e":this.setgLevel(1);break;case "\u000f":this.setgLevel(0);break;case "\u001b":this.state=1;break;default:if(e=C(e)," "<=d){this.charset&&this.charset[d]&&(d=this.charset[d]);f=this.y+this.ybase;if(!e&&this.x){this.lines[f][this.x-1]&&(this.lines[f][this.x-1][2]?this.lines[f][this.x-1][1]+=d:this.lines[f][this.x-2]&&(this.lines[f][this.x-2][1]+=d),this.updateRange(this.y));break}if(this.x+e-1>=this.cols)if(this.wraparoundMode)this.x=
0,this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll());else if(this.x=this.cols-1,2===e)continue;f=this.y+this.ybase;if(this.insertMode)for(var g=0;g<e;++g)0===this.lines[this.y+this.ybase].pop()[2]&&this.lines[f][this.cols-2]&&2===this.lines[f][this.cols-2][2]&&(this.lines[f][this.cols-2]=[this.curAttr," ",1]),this.lines[f].splice(this.x,0,[this.curAttr," ",1]);this.lines[f][this.x]=[this.curAttr,d,e];this.x++;this.updateRange(this.y);2===e&&(this.lines[f][this.x]=[this.curAttr,"",0],this.x++)}}break;
case 1:switch(d){case "[":this.params=[];this.currentParam=0;this.state=2;break;case "]":this.params=[];this.currentParam=0;this.state=3;break;case "P":this.params=[];this.currentParam=0;this.state=5;break;case "_":this.state=6;break;case "^":this.state=6;break;case "c":this.reset();break;case "E":this.x=0;case "D":this.index();break;case "M":this.reverseIndex();break;case "%":this.setgLevel(0);this.setgCharset(0,b.charsets.US);this.state=0;c++;break;case "(":case ")":case "*":case "+":case "-":case ".":switch(d){case "(":this.gcharset=
0;break;case ")":this.gcharset=1;break;case "*":this.gcharset=2;break;case "+":this.gcharset=3;break;case "-":this.gcharset=1;break;case ".":this.gcharset=2}this.state=4;break;case "/":this.gcharset=3;this.state=4;c--;break;case "N":break;case "O":break;case "n":this.setgLevel(2);break;case "o":this.setgLevel(3);break;case "|":this.setgLevel(3);break;case "}":this.setgLevel(2);break;case "~":this.setgLevel(1);break;case "7":this.saveCursor();this.state=0;break;case "8":this.restoreCursor();this.state=
0;break;case "#":this.state=0;c++;break;case "H":this.tabSet();break;case "=":this.log("Serial port requested application keypad.");this.applicationKeypad=!0;this.viewport.syncScrollArea();this.state=0;break;case ">":this.log("Switching back to normal keypad.");this.applicationKeypad=!1;this.viewport.syncScrollArea();this.state=0;break;default:this.state=0,this.error("Unknown ESC control: %s.",d)}break;case 4:switch(d){case "0":d=b.charsets.SCLD;break;case "A":d=b.charsets.UK;break;case "B":d=b.charsets.US;
break;case "4":d=b.charsets.Dutch;break;case "C":case "5":d=b.charsets.Finnish;break;case "R":d=b.charsets.French;break;case "Q":d=b.charsets.FrenchCanadian;break;case "K":d=b.charsets.German;break;case "Y":d=b.charsets.Italian;break;case "E":case "6":d=b.charsets.NorwegianDanish;break;case "Z":d=b.charsets.Spanish;break;case "H":case "7":d=b.charsets.Swedish;break;case "=":d=b.charsets.Swiss;break;case "/":d=b.charsets.ISOLatin;c++;break;default:d=b.charsets.US}this.setgCharset(this.gcharset,d);
this.gcharset=null;this.state=0;break;case 3:if("\u001b"===d||"\u0007"===d){"\u001b"===d&&c++;this.params.push(this.currentParam);switch(this.params[0]){case 0:case 1:case 2:this.params[1]&&(this.title=this.params[1],this.handleTitle(this.title))}this.params=[];this.state=this.currentParam=0}else this.params.length?this.currentParam+=d:"0"<=d&&"9">=d?this.currentParam=10*this.currentParam+d.charCodeAt(0)-48:";"===d&&(this.params.push(this.currentParam),this.currentParam="");break;case 2:if("?"===
d||">"===d||"!"===d){this.prefix=d;break}if("0"<=d&&"9">=d){this.currentParam=10*this.currentParam+d.charCodeAt(0)-48;break}if("$"===d||'"'===d||" "===d||"'"===d){this.postfix=d;break}this.params.push(this.currentParam);this.currentParam=0;if(";"===d)break;this.state=0;switch(d){case "A":this.cursorUp(this.params);break;case "B":this.cursorDown(this.params);break;case "C":this.cursorForward(this.params);break;case "D":this.cursorBackward(this.params);break;case "H":this.cursorPos(this.params);break;
case "J":this.eraseInDisplay(this.params);break;case "K":this.eraseInLine(this.params);break;case "m":this.prefix||this.charAttributes(this.params);break;case "n":this.prefix||this.deviceStatus(this.params);break;case "@":this.insertChars(this.params);break;case "E":this.cursorNextLine(this.params);break;case "F":this.cursorPrecedingLine(this.params);break;case "G":this.cursorCharAbsolute(this.params);break;case "L":this.insertLines(this.params);break;case "M":this.deleteLines(this.params);break;
case "P":this.deleteChars(this.params);break;case "X":this.eraseChars(this.params);break;case "`":this.charPosAbsolute(this.params);break;case "a":this.HPositionRelative(this.params);break;case "c":this.sendDeviceAttributes(this.params);break;case "d":this.linePosAbsolute(this.params);break;case "e":this.VPositionRelative(this.params);break;case "f":this.HVPosition(this.params);break;case "h":this.setMode(this.params);break;case "l":this.resetMode(this.params);break;case "r":this.setScrollRegion(this.params);
break;case "s":this.saveCursor(this.params);break;case "u":this.restoreCursor(this.params);break;case "I":this.cursorForwardTab(this.params);break;case "S":this.scrollUp(this.params);break;case "T":2>this.params.length&&!this.prefix&&this.scrollDown(this.params);break;case "Z":this.cursorBackwardTab(this.params);break;case "b":this.repeatPrecedingCharacter(this.params);break;case "g":this.tabClear(this.params);break;case "p":switch(this.prefix){case "!":this.softReset(this.params)}break;default:this.error("Unknown CSI code: %s.",
d)}this.postfix=this.prefix="";break;case 5:if("\u001b"===d||"\u0007"===d){"\u001b"===d&&c++;switch(this.prefix){case "":break;case "$q":d=this.currentParam;e=!1;switch(d){case '"q':d='0"q';break;case '"p':d='61"p';break;case "r":d=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r";break;case "m":d="0m";break;default:this.error("Unknown DCS Pt: %s.",d),d=""}this.send("\u001bP"+ +e+"$r"+d+"\u001b\\");break;case "+p":break;case "+q":d=this.currentParam;e=!1;this.send("\u001bP"+ +e+"+r"+d+"\u001b\\");
break;default:this.error("Unknown DCS prefix: %s.",this.prefix)}this.currentParam=0;this.prefix="";this.state=0}else this.currentParam?this.currentParam+=d:!this.prefix&&"$"!==d&&"+"!==d?this.currentParam=d:2===this.prefix.length?this.currentParam=d:this.prefix+=d;break;case 6:if("\u001b"===d||"\u0007"===d)"\u001b"===d&&c++,this.state=0}}this.updateRange(this.y);this.refresh(this.refreshStart,this.refreshEnd)};b.prototype.writeln=function(a){this.write(a+"\r\n")};b.prototype.attachCustomKeydownHandler=
function(a){this.customKeydownHandler=a};b.prototype.keyDown=function(a){this.ybase!==this.ydisp&&this.scrollToBottom();if(this.customKeydownHandler&&!1===this.customKeydownHandler(a)||!this.compositionHelper.keydown.bind(this.compositionHelper)(a))return!1;var b=this.evaluateKeyEscapeSequence(a);if(b.scrollDisp)return this.scrollDisp(b.scrollDisp),this.cancel(a,!0);if(p(this,a))return!0;b.cancel&&this.cancel(a,!0);if(!b.key)return!0;this.emit("keydown",a);this.emit("key",b.key,a);this.showCursor();
this.handler(b.key);return this.cancel(a,!0)};b.prototype.evaluateKeyEscapeSequence=function(a){var b={cancel:!1,key:void 0,scrollDisp:void 0},c=a.shiftKey<<0|a.altKey<<1|a.ctrlKey<<2|a.metaKey<<3;switch(a.keyCode){case 8:if(a.shiftKey){b.key="\u0008";break}b.key="\u007f";break;case 9:if(a.shiftKey){b.key="\u001b[Z";break}b.key="\t";b.cancel=!0;break;case 13:b.key="\r";b.cancel=!0;break;case 27:b.key="\u001b";b.cancel=!0;break;case 37:c?(b.key="\u001b[1;"+(c+1)+"D","\u001b[1;3D"==b.key&&(b.key="\u001b[1;5D")):
b.key=this.applicationCursor?"\u001bOD":"\u001b[D";break;case 39:c?(b.key="\u001b[1;"+(c+1)+"C","\u001b[1;3C"==b.key&&(b.key="\u001b[1;5C")):b.key=this.applicationCursor?"\u001bOC":"\u001b[C";break;case 38:c?(b.key="\u001b[1;"+(c+1)+"A","\u001b[1;3A"==b.key&&(b.key="\u001b[1;5A")):b.key=this.applicationCursor?"\u001bOA":"\u001b[A";break;case 40:c?(b.key="\u001b[1;"+(c+1)+"B","\u001b[1;3B"==b.key&&(b.key="\u001b[1;5B")):b.key=this.applicationCursor?"\u001bOB":"\u001b[B";break;case 45:!a.shiftKey&&
!a.ctrlKey&&(b.key="\u001b[2~");break;case 46:b.key=c?"\u001b[3;"+(c+1)+"~":"\u001b[3~";break;case 36:b.key=c?"\u001b[1;"+(c+1)+"H":this.applicationCursor?"\u001bOH":"\u001b[H";break;case 35:b.key=c?"\u001b[1;"+(c+1)+"F":this.applicationCursor?"\u001bOF":"\u001b[F";break;case 33:a.shiftKey?b.scrollDisp=-(this.rows-1):b.key="\u001b[5~";break;case 34:a.shiftKey?b.scrollDisp=this.rows-1:b.key="\u001b[6~";break;case 112:b.key=c?"\u001b[1;"+(c+1)+"P":"\u001bOP";break;case 113:b.key=c?"\u001b[1;"+(c+1)+
"Q":"\u001bOQ";break;case 114:b.key=c?"\u001b[1;"+(c+1)+"R":"\u001bOR";break;case 115:b.key=c?"\u001b[1;"+(c+1)+"S":"\u001bOS";break;case 116:b.key=c?"\u001b[15;"+(c+1)+"~":"\u001b[15~";break;case 117:b.key=c?"\u001b[17;"+(c+1)+"~":"\u001b[17~";break;case 118:b.key=c?"\u001b[18;"+(c+1)+"~":"\u001b[18~";break;case 119:b.key=c?"\u001b[19;"+(c+1)+"~":"\u001b[19~";break;case 120:b.key=c?"\u001b[20;"+(c+1)+"~":"\u001b[20~";break;case 121:b.key=c?"\u001b[21;"+(c+1)+"~":"\u001b[21~";break;case 122:b.key=
c?"\u001b[23;"+(c+1)+"~":"\u001b[23~";break;case 123:b.key=c?"\u001b[24;"+(c+1)+"~":"\u001b[24~";break;default:a.ctrlKey&&!a.shiftKey&&!a.altKey&&!a.metaKey?65<=a.keyCode&&90>=a.keyCode?b.key=String.fromCharCode(a.keyCode-64):32===a.keyCode?b.key=String.fromCharCode(0):51<=a.keyCode&&55>=a.keyCode?b.key=String.fromCharCode(a.keyCode-51+27):56===a.keyCode?b.key=String.fromCharCode(127):219===a.keyCode?b.key=String.fromCharCode(27):221===a.keyCode&&(b.key=String.fromCharCode(29)):!this.browser.isMac&&
a.altKey&&!a.ctrlKey&&!a.metaKey&&(65<=a.keyCode&&90>=a.keyCode?b.key="\u001b"+String.fromCharCode(a.keyCode+32):192===a.keyCode?b.key="\u001b`":48<=a.keyCode&&57>=a.keyCode&&(b.key="\u001b"+(a.keyCode-48)))}return b};b.prototype.setgLevel=function(a){this.glevel=a;this.charset=this.charsets[a]};b.prototype.setgCharset=function(a,b){this.charsets[a]=b;this.glevel===a&&(this.charset=b)};b.prototype.keyPress=function(a){var b;this.cancel(a);if(a.charCode)b=a.charCode;else if(null==a.which)b=a.keyCode;
else if(0!==a.which&&0!==a.charCode)b=a.which;else return!1;if(!b||(a.altKey||a.ctrlKey||a.metaKey)&&!p(this,a))return!1;b=String.fromCharCode(b);this.emit("keypress",b,a);this.emit("key",b,a);this.showCursor();this.handler(b);return!1};b.prototype.send=function(a){var b=this;this.queue||setTimeout(function(){b.handler(b.queue);b.queue=""},1);this.queue+=a};b.prototype.bell=function(){if(this.visualBell){var a=this;this.element.style.borderColor="white";setTimeout(function(){a.element.style.borderColor=
""},10);this.popOnBell&&this.focus()}};b.prototype.log=function(){this.debug&&this.context.console&&this.context.console.log&&this.context.console.log.apply(this.context.console,Array.prototype.slice.call(arguments))};b.prototype.error=function(){this.debug&&this.context.console&&this.context.console.error&&this.context.console.error.apply(this.context.console,Array.prototype.slice.call(arguments))};b.prototype.resize=function(a,b){var c,d,e;if(!(a===this.cols&&b===this.rows)){1>a&&(a=1);1>b&&(b=
1);d=this.cols;if(d<a){e=[this.defAttr," ",1];for(c=this.lines.length;c--;)for(;this.lines[c].length<a;)this.lines[c].push(e)}else for(c=this.lines.length;c--;)for(;this.lines[c].length>a;)this.lines[c].pop();this.setupStops(d);this.cols=a;d=this.rows;e=0;if(d<b)for(;d++<b;)this.lines.length<b+this.ybase&&(0<this.ybase&&this.lines.length<=this.ybase+this.y+e+1?(this.ybase--,e++,0<this.ydisp&&this.ydisp--):this.lines.push(this.blankLine())),this.children.length<b&&this.insertRow();else for(;d-- >b;)this.lines.length>
b+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++)),this.children.length>b&&(c=this.children.shift())&&c.parentNode.removeChild(c);this.rows=b;this.y>=b&&(this.y=b-1);e&&(this.y+=e);this.x>=a&&(this.x=a-1);this.scrollTop=0;this.scrollBottom=b-1;this.refresh(0,this.rows-1);this.normal=null;this.geometry=[this.cols,this.rows];this.emit("resize",{terminal:this,cols:a,rows:b})}};b.prototype.updateRange=function(a){a<this.refreshStart&&(this.refreshStart=
a);a>this.refreshEnd&&(this.refreshEnd=a)};b.prototype.maxRange=function(){this.refreshStart=0;this.refreshEnd=this.rows-1};b.prototype.setupStops=function(a){null!=a?this.tabs[a]||(a=this.prevStop(a)):(this.tabs={},a=0);for(;a<this.cols;a+=8)this.tabs[a]=!0};b.prototype.prevStop=function(a){null==a&&(a=this.x);for(;!this.tabs[--a]&&0<a;);return a>=this.cols?this.cols-1:0>a?0:a};b.prototype.nextStop=function(a){null==a&&(a=this.x);for(;!this.tabs[++a]&&a<this.cols;);return a>=this.cols?this.cols-
1:0>a?0:a};b.prototype.eraseRight=function(a,b){for(var c=this.lines[this.ybase+b],d=[this.eraseAttr()," ",1];a<this.cols;a++)c[a]=d;this.updateRange(b)};b.prototype.eraseLeft=function(a,b){var c=this.lines[this.ybase+b],d=[this.eraseAttr()," ",1];for(a++;a--;)c[a]=d;this.updateRange(b)};b.prototype.clear=function(){if(!(0===this.ybase&&0===this.y)){this.lines=[this.lines[this.ybase+this.y]];this.y=this.ybase=this.ydisp=0;for(var a=1;a<this.rows;a++)this.lines.push(this.blankLine());this.refresh(0,
this.rows-1);this.emit("scroll",this.ydisp)}};b.prototype.eraseLine=function(a){this.eraseRight(0,a)};b.prototype.blankLine=function(a){for(var a=[a?this.eraseAttr():this.defAttr," ",1],b=[],c=0;c<this.cols;c++)b[c]=a;return b};b.prototype.ch=function(a){return a?[this.eraseAttr()," ",1]:[this.defAttr," ",1]};b.prototype.is=function(a){return 0===(this.termName+"").indexOf(a)};b.prototype.handler=function(a){this.emit("data",a)};b.prototype.handleTitle=function(a){this.emit("title",a)};b.prototype.index=
function(){this.y++;this.y>this.scrollBottom&&(this.y--,this.scroll());this.state=0};b.prototype.reverseIndex=function(){var a;this.y--;this.y<this.scrollTop&&(this.y++,this.lines.splice(this.y+this.ybase,0,this.blankLine(!0)),a=this.rows-1-this.scrollBottom,this.lines.splice(this.rows-1+this.ybase-a+1,1),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom));this.state=0};b.prototype.reset=function(){this.options.rows=this.rows;this.options.cols=this.cols;var a=this.customKeydownHandler;
b.call(this,this.options);this.customKeydownHandler=a;this.refresh(0,this.rows-1);this.viewport.syncScrollArea()};b.prototype.tabSet=function(){this.tabs[this.x]=!0;this.state=0};b.prototype.cursorUp=function(a){a=a[0];1>a&&(a=1);this.y-=a;0>this.y&&(this.y=0)};b.prototype.cursorDown=function(a){a=a[0];1>a&&(a=1);this.y+=a;this.y>=this.rows&&(this.y=this.rows-1)};b.prototype.cursorForward=function(a){a=a[0];1>a&&(a=1);this.x+=a;this.x>=this.cols&&(this.x=this.cols-1)};b.prototype.cursorBackward=function(a){a=
a[0];1>a&&(a=1);this.x-=a;0>this.x&&(this.x=0)};b.prototype.cursorPos=function(a){var b;b=a[0]-1;a=2<=a.length?a[1]-1:0;0>b?b=0:b>=this.rows&&(b=this.rows-1);0>a?a=0:a>=this.cols&&(a=this.cols-1);this.x=a;this.y=b};b.prototype.eraseInDisplay=function(a){switch(a[0]){case 0:this.eraseRight(this.x,this.y);for(a=this.y+1;a<this.rows;a++)this.eraseLine(a);break;case 1:this.eraseLeft(this.x,this.y);for(a=this.y;a--;)this.eraseLine(a);break;case 2:for(a=this.rows;a--;)this.eraseLine(a)}};b.prototype.eraseInLine=
function(a){switch(a[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);break;case 2:this.eraseLine(this.y)}};b.prototype.charAttributes=function(a){if(1===a.length&&0===a[0])this.curAttr=this.defAttr;else{for(var b=a.length,c=0,d=this.curAttr>>18,e=this.curAttr>>9&511,f=this.curAttr&511,g;c<b;c++)g=a[c],30<=g&&37>=g?e=g-30:40<=g&&47>=g?f=g-40:90<=g&&97>=g?(g+=8,e=g-90):100<=g&&107>=g?(g+=8,f=g-100):0===g?(d=this.defAttr>>18,e=this.defAttr>>9&511,f=this.defAttr&511):
1===g?d|=1:4===g?d|=2:5===g?d|=4:7===g?d|=8:8===g?d|=16:22===g?d&=-2:24===g?d&=-3:25===g?d&=-5:27===g?d&=-9:28===g?d&=-17:39===g?e=this.defAttr>>9&511:49===g?f=this.defAttr&511:38===g?2===a[c+1]?(c+=2,e=j(a[c]&255,a[c+1]&255,a[c+2]&255),-1===e&&(e=511),c+=2):5===a[c+1]&&(c+=2,e=g=a[c]&255):48===g?2===a[c+1]?(c+=2,f=j(a[c]&255,a[c+1]&255,a[c+2]&255),-1===f&&(f=511),c+=2):5===a[c+1]&&(c+=2,f=g=a[c]&255):100===g?(e=this.defAttr>>9&511,f=this.defAttr&511):this.error("Unknown SGR attribute: %d.",g);this.curAttr=
d<<18|e<<9|f}};b.prototype.deviceStatus=function(a){if(this.prefix){if("?"===this.prefix)switch(a[0]){case 6:this.send("\u001b[?"+(this.y+1)+";"+(this.x+1)+"R")}}else switch(a[0]){case 5:this.send("\u001b[0n");break;case 6:this.send("\u001b["+(this.y+1)+";"+(this.x+1)+"R")}};b.prototype.insertChars=function(a){var b,c,d,a=a[0];1>a&&(a=1);b=this.y+this.ybase;c=this.x;for(d=[this.eraseAttr()," ",1];a--&&c<this.cols;)this.lines[b].splice(c++,0,d),this.lines[b].pop()};b.prototype.cursorNextLine=function(a){a=
a[0];1>a&&(a=1);this.y+=a;this.y>=this.rows&&(this.y=this.rows-1);this.x=0};b.prototype.cursorPrecedingLine=function(a){a=a[0];1>a&&(a=1);this.y-=a;0>this.y&&(this.y=0);this.x=0};b.prototype.cursorCharAbsolute=function(a){a=a[0];1>a&&(a=1);this.x=a-1};b.prototype.insertLines=function(a){var b,c,a=a[0];1>a&&(a=1);b=this.y+this.ybase;c=this.rows-1-this.scrollBottom;for(c=this.rows-1+this.ybase-c+1;a--;)this.lines.splice(b,0,this.blankLine(!0)),this.lines.splice(c,1);this.updateRange(this.y);this.updateRange(this.scrollBottom)};
b.prototype.deleteLines=function(a){var b,c,a=a[0];1>a&&(a=1);b=this.y+this.ybase;c=this.rows-1-this.scrollBottom;for(c=this.rows-1+this.ybase-c;a--;)this.lines.splice(c+1,0,this.blankLine(!0)),this.lines.splice(b,1);this.updateRange(this.y);this.updateRange(this.scrollBottom)};b.prototype.deleteChars=function(a){var b,c,a=a[0];1>a&&(a=1);b=this.y+this.ybase;for(c=[this.eraseAttr()," ",1];a--;)this.lines[b].splice(this.x,1),this.lines[b].push(c)};b.prototype.eraseChars=function(a){var b,c,d,a=a[0];
1>a&&(a=1);b=this.y+this.ybase;c=this.x;for(d=[this.eraseAttr()," ",1];a--&&c<this.cols;)this.lines[b][c++]=d};b.prototype.charPosAbsolute=function(a){a=a[0];1>a&&(a=1);this.x=a-1;this.x>=this.cols&&(this.x=this.cols-1)};b.prototype.HPositionRelative=function(a){a=a[0];1>a&&(a=1);this.x+=a;this.x>=this.cols&&(this.x=this.cols-1)};b.prototype.sendDeviceAttributes=function(a){0<a[0]||(this.prefix?">"===this.prefix&&(this.is("xterm")?this.send("\u001b[>0;276;0c"):this.is("rxvt-unicode")?this.send("\u001b[>85;95;0c"):
this.is("linux")?this.send(a[0]+"c"):this.is("screen")&&this.send("\u001b[>83;40003;0c")):this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")?this.send("\u001b[?1;2c"):this.is("linux")&&this.send("\u001b[?6c"))};b.prototype.linePosAbsolute=function(a){a=a[0];1>a&&(a=1);this.y=a-1;this.y>=this.rows&&(this.y=this.rows-1)};b.prototype.VPositionRelative=function(a){a=a[0];1>a&&(a=1);this.y+=a;this.y>=this.rows&&(this.y=this.rows-1)};b.prototype.HVPosition=function(a){1>a[0]&&(a[0]=1);1>a[1]&&
(a[1]=1);this.y=a[0]-1;this.y>=this.rows&&(this.y=this.rows-1);this.x=a[1]-1;this.x>=this.cols&&(this.x=this.cols-1)};b.prototype.setMode=function(a){if("object"===("undefined"===typeof a?"undefined":q(a)))for(var e=a.length,c=0;c<e;c++)this.setMode(a[c]);else if(this.prefix){if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!0;break;case 2:this.setgCharset(0,b.charsets.US);this.setgCharset(1,b.charsets.US);this.setgCharset(2,b.charsets.US);this.setgCharset(3,b.charsets.US);break;case 3:this.savedCols=
this.cols;this.resize(132,this.rows);break;case 6:this.originMode=!0;break;case 7:this.wraparoundMode=!0;break;case 66:this.log("Serial port requested application keypad.");this.applicationKeypad=!0;this.viewport.syncScrollArea();break;case 9:case 1E3:case 1002:case 1003:this.x10Mouse=9===a;this.vt200Mouse=1E3===a;this.normalMouse=1E3<a;this.mouseEvents=!0;this.element.style.cursor="default";this.log("Binding to mouse events.");break;case 1004:this.sendFocus=!0;break;case 1005:this.utfMouse=!0;break;
case 1006:this.sgrMouse=!0;break;case 1015:this.urxvtMouse=!0;break;case 25:this.cursorHidden=!1;break;case 1049:case 47:case 1047:this.normal||(a={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs},this.reset(),this.normal=a,this.showCursor())}}else switch(a){case 4:this.insertMode=!0}};b.prototype.resetMode=function(a){if("object"===("undefined"===typeof a?"undefined":q(a)))for(var b=a.length,c=0;c<b;c++)this.resetMode(a[c]);
else if(this.prefix){if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!1;break;case 3:132===this.cols&&this.savedCols&&this.resize(this.savedCols,this.rows);delete this.savedCols;break;case 6:this.originMode=!1;break;case 7:this.wraparoundMode=!1;break;case 66:this.log("Switching back to normal keypad.");this.applicationKeypad=!1;this.viewport.syncScrollArea();break;case 9:case 1E3:case 1002:case 1003:this.mouseEvents=this.normalMouse=this.vt200Mouse=this.x10Mouse=!1;this.element.style.cursor=
"";break;case 1004:this.sendFocus=!1;break;case 1005:this.utfMouse=!1;break;case 1006:this.sgrMouse=!1;break;case 1015:this.urxvtMouse=!1;break;case 25:this.cursorHidden=!0;break;case 1049:case 47:case 1047:this.normal&&(this.lines=this.normal.lines,this.ybase=this.normal.ybase,this.ydisp=this.normal.ydisp,this.x=this.normal.x,this.y=this.normal.y,this.scrollTop=this.normal.scrollTop,this.scrollBottom=this.normal.scrollBottom,this.tabs=this.normal.tabs,this.normal=null,this.refresh(0,this.rows-1),
this.showCursor())}}else switch(a){case 4:this.insertMode=!1}};b.prototype.setScrollRegion=function(a){this.prefix||(this.scrollTop=(a[0]||1)-1,this.scrollBottom=(a[1]||this.rows)-1,this.y=this.x=0)};b.prototype.saveCursor=function(){this.savedX=this.x;this.savedY=this.y};b.prototype.restoreCursor=function(){this.x=this.savedX||0;this.y=this.savedY||0};b.prototype.cursorForwardTab=function(a){for(a=a[0]||1;a--;)this.x=this.nextStop()};b.prototype.scrollUp=function(a){for(a=a[0]||1;a--;)this.lines.splice(this.ybase+
this.scrollTop,1),this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine());this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};b.prototype.scrollDown=function(a){for(a=a[0]||1;a--;)this.lines.splice(this.ybase+this.scrollBottom,1),this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine());this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};b.prototype.initMouseTracking=function(){};b.prototype.resetTitleModes=function(){};b.prototype.cursorBackwardTab=
function(a){for(a=a[0]||1;a--;)this.x=this.prevStop()};b.prototype.repeatPrecedingCharacter=function(a){for(var a=a[0]||1,b=this.lines[this.ybase+this.y],c=b[this.x-1]||[this.defAttr," ",1];a--;)b[this.x++]=c};b.prototype.tabClear=function(a){a=a[0];0>=a?delete this.tabs[this.x]:3===a&&(this.tabs={})};b.prototype.mediaCopy=function(){};b.prototype.setResources=function(){};b.prototype.disableModifiers=function(){};b.prototype.setPointerMode=function(){};b.prototype.softReset=function(){this.applicationKeypad=
this.wraparoundMode=this.originMode=this.insertMode=this.cursorHidden=!1;this.viewport.syncScrollArea();this.applicationCursor=!1;this.scrollTop=0;this.scrollBottom=this.rows-1;this.curAttr=this.defAttr;this.x=this.y=0;this.charset=null;this.glevel=0;this.charsets=[null]};b.prototype.requestAnsiMode=function(){};b.prototype.requestPrivateMode=function(){};b.prototype.setConformanceLevel=function(){};b.prototype.loadLEDs=function(){};b.prototype.setCursorStyle=function(){};b.prototype.setCharProtectionAttr=
function(){};b.prototype.restorePrivateValues=function(){};b.prototype.setAttrInRectangle=function(a){for(var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g,i;b<d+1;b++){g=this.lines[this.ybase+b];for(i=c;i<e;i++)g[i]=[f,g[i][1]]}this.updateRange(a[0]);this.updateRange(a[2])};b.prototype.fillRectangle=function(a){for(var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g,i;c<e+1;c++){g=this.lines[this.ybase+c];for(i=d;i<f;i++)g[i]=[g[i][0],String.fromCharCode(b)]}this.updateRange(a[1]);this.updateRange(a[3])};b.prototype.enableLocatorReporting=
function(){};b.prototype.eraseRectangle=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f,g,i;for(i=[this.eraseAttr()," ",1];b<d+1;b++){f=this.lines[this.ybase+b];for(g=c;g<e;g++)f[g]=i}this.updateRange(a[0]);this.updateRange(a[2])};b.prototype.insertColumns=function(){for(var a=params[0],b=this.ybase+this.rows,c=[this.eraseAttr()," ",1],d;a--;)for(d=this.ybase;d<b;d++)this.lines[d].splice(this.x+1,0,c),this.lines[d].pop();this.maxRange()};b.prototype.deleteColumns=function(){for(var a=params[0],b=this.ybase+
this.rows,c=[this.eraseAttr()," ",1],d;a--;)for(d=this.ybase;d<b;d++)this.lines[d].splice(this.x,1),this.lines[d].push(c);this.maxRange()};b.charsets={};b.charsets.SCLD={"`":"\u25c6",a:"\u2592",b:"\t",c:"\u000c",d:"\r",e:"\n",f:"\u00b0",g:"\u00b1",h:"\u2424",i:"\x0B",j:"\u2518",k:"\u2510",l:"\u250c",m:"\u2514",n:"\u253c",o:"\u23ba",p:"\u23bb",q:"\u2500",r:"\u23bc",s:"\u23bd",t:"\u251c",u:"\u2524",v:"\u2534",w:"\u252c",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03c0","|":"\u2260","}":"\u00a3","~":"\u00b7"};
b.charsets.UK=null;b.charsets.US=null;b.charsets.Dutch=null;b.charsets.Finnish=null;b.charsets.French=null;b.charsets.FrenchCanadian=null;b.charsets.German=null;b.charsets.Italian=null;b.charsets.NorwegianDanish=null;b.charsets.Spanish=null;b.charsets.Swedish=null;b.charsets.Swiss=null;b.charsets.ISOLatin=null;j._cache={};j.distance=function(a,b,c,d,e,f){return Math.pow(30*(a-d),2)+Math.pow(59*(b-e),2)+Math.pow(11*(c-f),2)};var C=function(a){var b=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,
1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,
2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,
4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],
[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];return function(c){if(0===c)return a.nul;if(32>c||127<=c&&160>c)return a.control;var d;a:{d=0;var e=b.length-1,f;if(!(c<b[0][0]||c>b[e][1]))for(;e>=d;)if(f=Math.floor((d+e)/2),c>b[f][1])d=f+1;else if(c<b[f][0])e=f-1;else{d=!0;break a}d=!1}return d?0:1+(4352<=c&&(4447>=c||9001==c||9002==c||11904<=c&&42191>=
c&&12351!=c||44032<=c&&55203>=c||63744<=c&&64255>=c||65040<=c&&65049>=c||65072<=c&&65135>=c||65280<=c&&65376>=c||65504<=c&&65510>=c||131072<=c&&196605>=c||196608<=c&&262141>=c))}}({nul:0,control:0});b.EventEmitter=u.EventEmitter;b.CompositionHelper=r.CompositionHelper;b.Viewport=y.Viewport;b.inherits=i;b.on=m;b.off=f;b.cancel=function(a,b){if(this.cancelEvents||b)return a.preventDefault(),a.stopPropagation(),!1};n.exports=b},{"./CompositionHelper.js":1,"./EventEmitter.js":2,"./Viewport.js":3,"./handlers/Clipboard.js":4,
"./utils/Browser":5}]},{},[7])(7)});
